!function(e,i){e.init({gestureConfig:{tap:!0,doubletap:!0,longtap:!0,swipe:!0,drag:!0,hold:!0,release:!0}});var t="ontouchstart"in i,a=t?"tap":"click",r=t?"tap":"click",n=e.className("image");e.dom=function(t){return e.__create_dom_div__||(e.__create_dom_div__=i.createElement("div")),e.__create_dom_div__.innerHTML=t,e.__create_dom_div__.childNodes};var s=e.ImageViewer=e.Class.extend({init:function(e,i){var a=this;a.options=i||{},a.selector=e||"img",a.options.dbl&&(r=t?"doubletap":"dblclick"),a.findAllImage(),a.createViewer(),a.bindEvent()},createViewer:function(){var t=this;t.viewer=e.dom("<div class='mui-imageviewer'><div class='mui-imageviewer-mask'></div><div class='mui-imageviewer-header'><i class='mui-icon mui-icon-closeempty mui-imageviewer-close'></i><span class='mui-imageviewer-state'></span></div><i class='mui-icon mui-icon-arrowleft  mui-imageviewer-left'></i><i class='mui-icon mui-icon-arrowright mui-imageviewer-right'></i></div>"),t.viewer=t.viewer[0]||t.viewer,t.closeButton=t.viewer.querySelector(".mui-imageviewer-close"),t.state=t.viewer.querySelector(".mui-imageviewer-state"),t.leftButton=t.viewer.querySelector(".mui-imageviewer-left"),t.rightButton=t.viewer.querySelector(".mui-imageviewer-right"),t.mask=t.viewer.querySelector(".mui-imageviewer-mask"),i.body.appendChild(t.viewer)},findAllImage:function(){var i=this;i.images=[].slice.call(e(i.selector))},checkImage:function(e){var i=this;return"IMG"===e.tagName&&i.images.some(function(i){return i==e})},bindEvent:function(){var t=this;i.addEventListener(r,function(e){if(t.viewer){var i=e.target;t.checkImage(i)&&(t.viewer.style.display="block",setTimeout(function(){t.viewer.style.opacity=1},0),t.index=t.images.indexOf(i),t.currentItem=t.createImage(t.index))}},!1),t.closeButton.addEventListener(a,function(e){t.viewer.style.opacity=0,setTimeout(function(){t.viewer.style.display="none",t.disposeImage(!0)},600),e.preventDefault(),e.cancelBubble=!0},!1),t.leftButton.addEventListener(a,function(){t.prev()},!1),t.rightButton.addEventListener(a,function(){t.next()},!1),t.mask.addEventListener(e.EVENT_MOVE,function(e){e.preventDefault(),e.cancelBubble=!0},!1),t.viewer.addEventListener("swipeleft",function(e){1==t.scaleValue&&t.next(),e.preventDefault(),e.cancelBubble=!0},!1),t.viewer.addEventListener("swiperight",function(e){1==t.scaleValue&&t.prev(),e.preventDefault(),e.cancelBubble=!0},!1),t.viewer.addEventListener(e.EVENT_START,function(e){var i=e.touches;if(2==i.length){var a=i[0],r=i[1],n=a.pageX-r.pageX,s=a.pageY-r.pageY;t.scaleStart=Math.sqrt(n*n+s*s),t.isMultiTouch=!0}else(i.length=1)&&(t.dragStart=i[0])},!1),t.viewer.addEventListener(e.EVENT_MOVE,function(e){var i=t.currentItem.querySelector("img"),a=e.changedTouches;if(2==a.length){e.preventDefault(),e.cancelBubble=!0;var r=a[0],n=a[1],s=r.pageX-n.pageX,l=r.pageY-n.pageY;t.scaleEnd=Math.sqrt(s*s+l*l),t._scaleValue=t.scaleValue*(t.scaleEnd/t.scaleStart),i.style.webkitTransform="scale("+t._scaleValue+","+t._scaleValue+") "}else t.isMultiTouch||1!=a.length||1==t.scaleValue||(e.preventDefault(),e.cancelBubble=!0,t.dragEnd=a[0],t._dragX=t.dragX+(t.dragEnd.pageX-t.dragStart.pageX),t._dragY=t.dragY+(t.dragEnd.pageY-t.dragStart.pageY),i.style.marginLeft=t._dragX+"px",i.style.marginTop=t._dragY+"px")},!1),t.viewer.addEventListener(e.EVENT_END,function(){t.scaleValue=t._scaleValue||t.scaleValue,t._scaleValue=null,t.dragX=t._dragX,t.dragY=t._dragY,t._dragX=null,t._dragY=null;var e=event.touches;t.isMultiTouch=0!=e.length}),t.viewer.addEventListener("doubletap",function(){var e=t.currentItem.querySelector("img");1===t.scaleValue?t.scaleValue=2:t.scaleValue=1,t.dragX=0,t.dragY=0,e.style.marginLeft=t.dragX+"px",e.style.marginTop=t.dragY+"px",e.style.webkitTransform="scale("+t.scaleValue+","+t.scaleValue+") ",t.viewer.__tap_num=0},!1)},next:function(){var e=this;e.mask.style.display="block",e.index++;var i=e.createImage(e.index,"right");setTimeout(function(){e.currentItem.classList.remove("mui-imageviewer-item-center"),e.currentItem.classList.add("mui-imageviewer-item-left"),i.classList.remove("mui-imageviewer-item-right"),i.classList.add("mui-imageviewer-item-center"),e.oldItem=e.currentItem,e.currentItem=i,setTimeout(function(){e.disposeImage(),e.mask.style.display="none"},600)},25)},prev:function(){var e=this;e.mask.style.display="block",e.index--;var i=e.createImage(e.index,"left");setTimeout(function(){e.currentItem.classList.remove("mui-imageviewer-item-center"),e.currentItem.classList.add("mui-imageviewer-item-right"),i.classList.remove("mui-imageviewer-item-left"),i.classList.add("mui-imageviewer-item-center"),e.oldItem=e.currentItem,e.currentItem=i,setTimeout(function(){e.disposeImage(),e.mask.style.display="none"},600)},25)},disposeImage:function(i){var t=".mui-imageviewer-item-left,.mui-imageviewer-item-right";i&&(t+=",.mui-imageviewer-item");var a=e(t);a.each(function(e,i){i.parentNode&&i.parentNode.removeChild&&i.parentNode.removeChild(i,!0)})},createImage:function(i,t){var a=this;t=t||"center",i<0&&(i=a.images.length-1),i>a.images.length-1&&(i=0),a.index=i;var r=e.dom("<div class='mui-imageviewer-item'></div>")[0];return r.appendChild(e.dom('<span><img src="'+a.images[a.index].src+'"/></span>')[0]),r.classList.add("mui-imageviewer-item-"+t),a.viewer.appendChild(r),a.state.innerText=a.index+1+"/"+a.images.length,a.scaleValue=1,a.dragX=0,a.dragY=0,r}});e.imageViewer=function(e,i){return new s(e,i)},e.ready(function(){e.imageViewer("."+n)})}(mui,document);