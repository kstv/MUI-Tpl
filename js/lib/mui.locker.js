!function(t,e){function o(t){for(var e=t.offsetLeft,o=t.offsetParent;null!==o;)e+=o.offsetLeft,o=o.offsetParent;return e}function n(t){for(var e=t.offsetTop,o=t.offsetParent;null!==o;)e+=o.offsetTop,o=o.offsetParent;return e}var i="ontouchstart"in document,r=i?"touchstart":"mousedown",a=i?"touchmove":"mousemove",l=i?"touchend":"mouseup",c=t.className("locker-holder"),s=t.className("locker"),h=e.querySelector("head")||e.querySelector("body");h.innerHTML+="<style>.mui-locker-holder{overflow:hidden;position:relative;padding:0px;}.mui-locker-holder canvas{width:100%;height:100%;}</style>";var f=4,d=t.Locker=t.Class.extend({R:26,CW:400,CH:320,OffsetX:30,OffsetY:30,init:function(e,o){var n=this;if(!e)throw"构造 Locker 时缺少容器元素";if(n.holder=e,!n.holder.__locker_inited){n.holder.__locker_inited=!0,n.options=o||{},n.options.callback=n.options.callback||n.options.done||t.noop,n.holder.innerHTML="<canvas></canvas>",n.holder.classList.add(c);var i=n.canvas=t.qsa("canvas",n.holder)[0];i.on=i.addEventListener||function(t,e,o){i.attachEvent("on"+t,e,o)},i.off=i.removeEventListener||function(t,e,o){i.detachEvent("on"+t,e,o)},n.options.width&&(n.holder.style.width=n.options.width+"px"),n.options.height&&(n.holder.style.height=n.options.height+"px"),n.CW=n.options.width||n.holder.offsetWidth||n.CW,n.CH=n.options.height||n.holder.offsetHeight||n.CH,n.R*=f,n.CW*=f,n.CH*=f,n.OffsetX*=f,n.OffsetY*=f,i.width=n.CW,i.height=n.CH;var r=n.cxt=i.getContext("2d"),a=(n.CW-2*n.OffsetX-2*n.R*3)/2,l=(n.CH-2*n.OffsetY-2*n.R*3)/2;n.pointLocationArr=n.caculateNinePointLotion(a,l),n.initEvent(i,r,n.holder),n.draw(r,n.pointLocationArr,[],null),setTimeout(function(){n.draw(r,n.pointLocationArr,[],null)},0)}},caculateNinePointLotion:function(t,e){for(var o=this,n=[],i=0;i<3;i++)for(var r=0;r<3;r++){var a={X:o.OffsetX+r*t+(2*r+1)*o.R,Y:o.OffsetY+i*e+(2*i+1)*o.R};n.push(a)}return n},draw:function(t,e,o,n){var i=this,r=i.R;if(o.length>0){t.beginPath();for(var a=0;a<o.length;a++){var l=o[a];t.lineTo(e[l].X,e[l].Y)}if(t.lineWidth=2*f,t.strokeStyle=i.options.lineColor||"#999",t.stroke(),t.closePath(),null!=n){var c=o[o.length-1],s=e[c];t.beginPath(),t.moveTo(s.X,s.Y),t.lineTo(n.X,n.Y),t.stroke(),t.closePath()}}for(var a=0;a<e.length;a++){var h=e[a];t.fillStyle=i.options.ringColor||"#888",t.beginPath(),t.arc(h.X,h.Y,r,0,Math.PI*f,!0),t.closePath(),t.fill(),t.fillStyle=i.options.fillColor||"#f3f3f3",t.beginPath(),t.arc(h.X,h.Y,r-2*f,0,Math.PI*f,!0),t.closePath(),t.fill(),o.indexOf(a)>=0&&(t.fillStyle=i.options.pointColor||"#777",t.beginPath(),t.arc(h.X,h.Y,r-16*f,0,Math.PI*f,!0),t.closePath(),t.fill())}},isPointSelect:function(t,e){for(var o=this,n=0;n<o.pointLocationArr.length;n++){var i=o.pointLocationArr[n],r=Math.abs(i.X-t.elementX),a=Math.abs(i.Y-t.elementY),l=Math.pow(r*r+a*a,.5);if(l<o.R){e.indexOf(n)<0&&e.push(n);break}}},initEvent:function(e,i,c){var s=this,h=[],d=!1;s._startHandler=function(t){t.point=event.changedTouches?event.changedTouches[0]:event,t.point.elementX=(t.point.pageX-o(c))*f,t.point.elementY=(t.point.pageY-n(c))*f,s.isPointSelect(t.point,h),d=!0},e.on(r,s._startHandler,!1),s._moveHanlder=function(t){if(d){t.preventDefault(),t.point=event.changedTouches?event.changedTouches[0]:event,t.point.elementX=(t.point.pageX-o(c))*f,t.point.elementY=(t.point.pageY-n(c))*f;var e=t.point;s.isPointSelect(e,h),i.clearRect(0,0,s.CW,s.CH),s.draw(i,s.pointLocationArr,h,{X:e.elementX,Y:e.elementY})}},e.on(a,s._moveHanlder,!1),s._endHandler=function(e){e.point=event.changedTouches?event.changedTouches[0]:event,e.point.elementX=(e.point.pageX-o(c))*f,e.point.elementY=(e.point.pageY-n(c))*f,i.clearRect(0,0,s.CW,s.CH),s.draw(i,s.pointLocationArr,h,null);var r={sender:s,points:h};s.options.callback(r),t.trigger(s.holder,"done",r),h=[],d=!1},e.on(l,s._endHandler,!1)},pointLocationArr:[],clear:function(){var t=this;t.cxt&&(t.cxt.clearRect(0,0,t.CW,t.CH),t.draw(t.cxt,t.pointLocationArr,[],{X:0,Y:0}))},dispose:function(){var t=this;t.cxt=null,t.canvas.off(r,t._startHandler),t.canvas.off(a,t._moveHandler),t.canvas.off(l,t._endHandler),t.holder.innerHTML="",t.canvas=null}});t.fn.locker=function(t){return this.each(function(t,e){if(n)new d(e,n);else{var o=e.getAttribute("data-locker-options"),n=o?JSON.parse(o):{};n.lineColor=e.getAttribute("data-locker-line-color")||n.lineColor,n.ringColor=e.getAttribute("data-locker-ring-color")||n.ringColor,n.fillColor=e.getAttribute("data-locker-fill-color")||n.fillColor,n.pointColor=e.getAttribute("data-locker-point-color")||n.pointColor,n.width=e.getAttribute("data-locker-width")||n.width,n.height=e.getAttribute("data-locker-height")||n.height,new d(e,n)}}),this};try{t("."+s).locker()}catch(t){}t.ready(function(){t("."+s).locker()})}(mui,document);